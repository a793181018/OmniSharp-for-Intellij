<?xml version="1.0" encoding="UTF-8"?>
<idea-plugin>
  <id>com.github.a793181018.omnisharpforintellij</id>
  <name>OmniSharp for IntelliJ</name>
  <version>1.0.0</version>
  <vendor email="your.email@example.com" url="https://github.com/a793181018/OmniSharp-for-Intellij">a793181018</vendor>

  <description><![CDATA[
    OmniSharp integration for IntelliJ IDEA and other JetBrains IDEs.
    Provides C# language support through the OmniSharp server.
  ]]></description>

  <change-notes><![CDATA[
    <p>Initial release of OmniSharp for IntelliJ.</p>
    <p>Features:</p>
    <ul>
      <li>Integration with OmniSharp server</li>
      <li>Session management for multiple projects</li>
      <li>Configurable server settings</li>
      <li>Code formatting support</li>
      <li>Automatic formatting on save</li>
    </ul>
  ]]></change-notes>

  <!-- 插件兼容性设置 -->
  <idea-version since-build="211.7142" />

  <!-- 依赖的其他插件 -->
  <depends>com.intellij.modules.platform</depends>

  <!-- 插件组件注册 -->
  <components>
    <!-- 应用级组件 -->
    <component>
      <implementation-class>com.github.a793181018.omnisharpforintellij.OmniSharpPlugin</implementation-class>
    </component>
    <component>
      <implementation-class>com.github.a793181018.omnisharpforintellij.configuration.OmniSharpSettings</implementation-class>
    </component>

    <!-- 项目级组件 -->
    <project-component>
      <implementation-class>com.github.a793181018.omnisharpforintellij.OmniSharpProjectComponent</implementation-class>
    </project-component>
    <project-component>
      <implementation-class>com.github.a793181018.omnisharpforintellij.session.OmniSharpSessionManager</implementation-class>
    </project-component>
    <project-component>
      <implementation-class>com.github.a793181018.omnisharpforintellij.server.OmniSharpServerManager</implementation-class>
    </project-component>
    <project-component>
      <implementation-class>com.github.a793181018.omnisharpforintellij.configuration.OmniSharpConfigurationImpl</implementation-class>
    </project-component>
    <project-component>
      <implementation-class>com.github.a793181018.omnisharpforintellij.editor.diagnostics.impl.OmniSharpDiagnosticsService</implementation-class>
    </project-component>
    <project-component>
      <implementation-class>com.github.a793181018.omnisharpforintellij.editor.formatting.OmniSharpFormattingService</implementation-class>
    </project-component>
    <project-component>
      <implementation-class>com.github.a793181018.omnisharpforintellij.editor.formatting.OmniSharpFormattingSettings</implementation-class>
    </project-component>
  </components>

  <!-- 扩展点注册 -->
  <extensions defaultExtensionNs="com.intellij">
    <!-- 项目管理器监听器 -->
    <projectManagerListener implementation="com.github.a793181018.omnisharpforintellij.server.OmniSharpServerManager$ProjectCloseListener" />
    
    <!-- 文件保存监听器 -->
    <fileDocumentManagerListener implementation="com.github.a793181018.omnisharpforintellij.editor.formatting.listener.OmniSharpDocumentFormattingListener" />

    <!-- 文件结构视图工厂 -->
    <lang.psiStructureViewFactory 
        language="C#" 
        implementationClass="com.github.a793181018.omnisharpforintellij.editor.navigation.structure.impl.OmniSharpStructureViewFactory" />

    <!-- 诊断工具窗口 -->
    <toolWindow 
        id="OmniSharp Diagnostics" 
        anchor="bottom" 
        factoryClass="com.github.a793181018.omnisharpforintellij.editor.diagnostics.impl.OmniSharpDiagnosticsToolWindowFactory" 
        icon="AllIcons.Toolwindows.Problems" 
        canCloseContents="true" 
        secondary="false" />

    <!-- 诊断标注器 -->
    <annotator 
        language="C#" 
        implementationClass="com.github.a793181018.omnisharpforintellij.editor.diagnostics.impl.OmniSharpDiagnosticsAnnotator" />

    <!-- 设置页面 -->
    <applicationConfigurable 
        instance="com.github.a793181018.omnisharpforintellij.configuration.OmniSharpConfigurable" 
        id="OmniSharpSettings" 
        groupId="tools" 
        groupPath="OmniSharp" 
        displayName="OmniSharp" />
    <projectConfigurable 
        instance="com.github.a793181018.omnisharpforintellij.configuration.OmniSharpConfigurable" 
        id="OmniSharpProjectSettings" 
        groupId="tools" 
        groupPath="OmniSharp" 
        displayName="OmniSharp" />
    
    <!-- 诊断设置页面 -->
    <projectConfigurable 
        instance="com.github.a793181018.omnisharpforintellij.editor.diagnostics.impl.OmniSharpDiagnosticsConfig" 
        id="OmniSharpDiagnosticsSettings" 
        groupId="tools" 
        groupPath="OmniSharp/Diagnostics" 
        displayName="Diagnostics" />
    
    <!-- 格式化设置页面 -->
    <projectConfigurable 
        instance="com.github.a793181018.omnisharpforintellij.editor.formatting.config.OmniSharpFormattingConfigurable" 
        id="OmniSharpFormattingSettings" 
        groupId="tools" 
        groupPath="OmniSharp/Formatting" 
        displayName="Formatting" />
  </extensions>

  <!-- 操作注册 -->
  <actions>
    <!-- 代码格式化操作 -->
    <action id="OmniSharpReformatCode"
            class="com.github.a793181018.omnisharpforintellij.editor.formatting.action.OmniSharpReformatCodeAction"
            text="Reformat Code"
            description="Reformat C# code using OmniSharp">
      <add-to-group group-id="CodeMenu" anchor="first"/>
      <add-to-group group-id="EditorActions" anchor="first"/>
      <add-to-group group-id="GenerateGroup" anchor="first"/>
      <keyboard-shortcut keymap="$default" first-keystroke="ctrl alt L"/>
    </action>
    
    <!-- 选择格式化操作 -->
    <action id="OmniSharpReformatSelection"
            class="com.github.a793181018.omnisharpforintellij.editor.formatting.action.OmniSharpReformatSelectionAction"
            text="Reformat Selection"
            description="Reformat selected C# code using OmniSharp">
      <add-to-group group-id="CodeMenu" anchor="first"/>
      <add-to-group group-id="EditorActions" anchor="first"/>
      <add-to-group group-id="GenerateGroup" anchor="first"/>
      <keyboard-shortcut keymap="$default" first-keystroke="ctrl alt L"/>
    </action>
  </actions>

  <!-- 资源路径 -->
  <resource-bundle>messages.OmniSharpBundle</resource-bundle>
</idea-plugin>
